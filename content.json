[{"title":"博客添加spine模型避坑指南【FRD 02】","date":"2025-05-18T06:56:24.000Z","path":"spineModel/","text":"前言心血来潮想给网页右下角添加明日方舟小人模型，我知道明日方舟的模型是基于spine3.8的 在Hexo博客里放一只明日方舟小人的SpineModel中提供了详细教程，发布日期也很近，但我依然在操作过程中遇到了麻烦，因此分享一下避坑经验 注意：本教程需要你拥有spine 3.8.x软件，学习版请自己上网查找 正文我的目录结构 此教程通过scripts文件夹下的文件利用hexo自带的劫持功能实现 除了模型文件，其他的在前言部分的文章中均已提供 文件处理models文件夹下面的文件需要去prts.wiki下 具体方法是加载网页，F12打开开发工具，网络选项卡，点击页面的载入模型按钮，即可看到相关文件，双击即可下载下来 避坑点1：2025.04后明日方舟所有的基建模型都更新了，atlas对不上png文件，在使用spine解包纹理时会出错，你需要手动缩放png文件，或前往Arknights Spine Models (Excerpt) | 明日方舟Spine动画小人模型(节选) 下载已经处理完毕的png文件 避坑点2：下载下来的文件名不要改，github下下来的png文件名有可能是修改过的，你需要改回prtswiki下下来的文件名，因为spine的纹理图集和贴图文件名是绑定的 理论上来讲此时已经可以直接把这些文件扔进去了，但是我这边会出现部分贴图错误的问题 这种情况要打开spine，最好是管理员身份，左上角-纹理解包器，指定一个无中文目录（如果不这样做会遇到未知错误）解包，然后再使用内置的纹理打包器重新打包一遍，得到新的atlas和png文件，覆盖之前下载下来的 代码处理在spine-widget.js中，最好把有关js文件地址修改为自己的spine-player.js中 1const spine_model_path = &quot;/path/spine/models/&quot;; 修改成你自己的模型路径 12345var MODELS = [ // 模型列表 &quot;model1&quot;,// 可用模型列表 &quot;model2&quot;, &quot;model3&quot;,]; 这里需要填入你下载下来的文件名，不需要后缀例如我的是build_char_017_huang_witch_5 build_char_017_huang build_char_017_huang_as_1 build_char_1040_blaze2 123456var MODELS = [ // 模型列表 &quot;build_char_017_huang_witch_5&quot;, &quot;build_char_017_huang&quot;, // 可用模型列表 &quot;build_char_017_huang_as_1&quot;, &quot;build_char_1040_blaze2&quot;,]; 里面的模型每刷新一次就会随机更换 模型显示大小调整spine-widget.css 12width: 400px;height: 400px; spine-widget.js 12canvas.width = 400;canvas.height = 400; 修改成你想要的，默认分别是250x250，300x300 我建议都调成300x300，我自己用的是400x400 当然参数怎么调看你的心意，只是太大会很糊","raw":"---\ntitle: 博客添加spine模型避坑指南【FRD 02】\ndate: 2025-05-18 14:56:24\ntags:\n    - 前端\ncategories:\n    - 教程\ncover: /cover/03.png\ncoverWdith: 812\ncoverHeight: 500\n---\n# 前言\n心血来潮想给网页右下角添加明日方舟小人模型，我知道明日方舟的模型是基于spine3.8的\n\n[在Hexo博客里放一只明日方舟小人的SpineModel</h1>](https://rimrose.top/SpineModel/)中提供了详细教程，发布日期也很近，但我依然在操作过程中遇到了麻烦，因此分享一下避坑经验\n\n注意：本教程需要你拥有spine 3.8.x软件，学习版请自己上网查找\n\n# 正文\n## 我的目录结构\n![目录结构](/workimg/02/01.png)\n\n此教程通过scripts文件夹下的文件利用hexo自带的劫持功能实现\n\n除了模型文件，其他的在前言部分的文章中均已提供\n## 文件处理\nmodels文件夹下面的文件需要去prts.wiki下\n\n具体方法是加载网页，F12打开开发工具，网络选项卡，点击页面的载入模型按钮，即可看到相关文件，双击即可下载下来\n![开发工具](/workimg/02/02.png)\n\n避坑点1：2025.04后明日方舟所有的**基建**模型都更新了，atlas对不上png文件，在使用spine解包纹理时会出错，你需要手动缩放png文件，或前往[Arknights Spine Models (Excerpt) | 明日方舟Spine动画小人模型(节选) ](https://github.com/isHarryh/Ark-Models/)下载已经处理完毕的png文件\n\n避坑点2：下载下来的文件名不要改，github下下来的png文件名有可能是修改过的，你需要改回prtswiki下下来的文件名，因为spine的纹理图集和贴图文件名是绑定的\n\n理论上来讲此时已经可以直接把这些文件扔进去了，但是我这边会出现部分贴图错误的问题\n\n这种情况要打开spine，最好是**管理员身份**，左上角-纹理解包器，指定一个无中文目录（如果不这样做会遇到未知错误）解包，然后再使用内置的纹理打包器重新打包一遍，得到新的atlas和png文件，覆盖之前下载下来的\n\n## 代码处理\n在``spine-widget.js``中，最好把有关js文件地址修改为自己的\n``spine-player.js``中\n```json\nconst spine_model_path = \"/path/spine/models/\";\n```\n修改成你自己的模型路径\n```json\nvar MODELS = [ // 模型列表\n    \"model1\",// 可用模型列表\n    \"model2\", \n    \"model3\",\n];\n```\n这里需要填入你下载下来的文件名，不需要后缀\n例如我的是``build_char_017_huang_witch_5`` ``build_char_017_huang`` ``build_char_017_huang_as_1`` ``build_char_1040_blaze2``\n```json\nvar MODELS = [ // 模型列表\n    \"build_char_017_huang_witch_5\",\n    \"build_char_017_huang\", // 可用模型列表\n    \"build_char_017_huang_as_1\",\n    \"build_char_1040_blaze2\",\n];\n```\n里面的模型每刷新一次就会随机更换\n\n## 模型显示大小调整\n``spine-widget.css``\n```css\nwidth: 400px;\nheight: 400px;\n```\n``spine-widget.js``\n```css\ncanvas.width = 400;\ncanvas.height = 400;\n```\n\n修改成你想要的，默认分别是250x250，300x300\n\n我建议都调成300x300，我自己用的是400x400\n\n当然参数怎么调看你的心意，只是太大会很糊","content":"<h1 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h1><p>心血来潮想给网页右下角添加明日方舟小人模型，我知道明日方舟的模型是基于spine3.8的</p>\n<p><a href=\"https://rimrose.top/SpineModel/\">在Hexo博客里放一只明日方舟小人的SpineModel</h1></a>中提供了详细教程，发布日期也很近，但我依然在操作过程中遇到了麻烦，因此分享一下避坑经验</p>\n<p>注意：本教程需要你拥有spine 3.8.x软件，学习版请自己上网查找</p>\n<h1 id=\"正文\"><a href=\"#正文\" class=\"headerlink\" title=\"正文\"></a>正文</h1><h2 id=\"我的目录结构\"><a href=\"#我的目录结构\" class=\"headerlink\" title=\"我的目录结构\"></a>我的目录结构</h2><p><img onerror=\"imgOnError(this);\" data-fancybox=\"gallery\" src=\"/workimg/02/01.png\" alt=\"目录结构\" data-caption=\"目录结构\" loading=\"lazy\"></p>\n<p>此教程通过scripts文件夹下的文件利用hexo自带的劫持功能实现</p>\n<p>除了模型文件，其他的在前言部分的文章中均已提供</p>\n<h2 id=\"文件处理\"><a href=\"#文件处理\" class=\"headerlink\" title=\"文件处理\"></a>文件处理</h2><p>models文件夹下面的文件需要去prts.wiki下</p>\n<p>具体方法是加载网页，F12打开开发工具，网络选项卡，点击页面的载入模型按钮，即可看到相关文件，双击即可下载下来<br><img onerror=\"imgOnError(this);\" data-fancybox=\"gallery\" src=\"/workimg/02/02.png\" alt=\"开发工具\" data-caption=\"开发工具\" loading=\"lazy\"></p>\n<p>避坑点1：2025.04后明日方舟所有的<strong>基建</strong>模型都更新了，atlas对不上png文件，在使用spine解包纹理时会出错，你需要手动缩放png文件，或前往<a href=\"https://github.com/isHarryh/Ark-Models/\">Arknights Spine Models (Excerpt) | 明日方舟Spine动画小人模型(节选) </a>下载已经处理完毕的png文件</p>\n<p>避坑点2：下载下来的文件名不要改，github下下来的png文件名有可能是修改过的，你需要改回prtswiki下下来的文件名，因为spine的纹理图集和贴图文件名是绑定的</p>\n<p>理论上来讲此时已经可以直接把这些文件扔进去了，但是我这边会出现部分贴图错误的问题</p>\n<p>这种情况要打开spine，最好是<strong>管理员身份</strong>，左上角-纹理解包器，指定一个无中文目录（如果不这样做会遇到未知错误）解包，然后再使用内置的纹理打包器重新打包一遍，得到新的atlas和png文件，覆盖之前下载下来的</p>\n<h2 id=\"代码处理\"><a href=\"#代码处理\" class=\"headerlink\" title=\"代码处理\"></a>代码处理</h2><p>在<code>spine-widget.js</code>中，最好把有关js文件地址修改为自己的<br><code>spine-player.js</code>中</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">const spine_model_path = <span class=\"hljs-string\">&quot;/path/spine/models/&quot;</span>;<br></code></pre></td></tr></table></figure>\n<p>修改成你自己的模型路径</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">var MODELS = <span class=\"hljs-punctuation\">[</span> <span class=\"hljs-comment\">// 模型列表</span><br>    <span class=\"hljs-string\">&quot;model1&quot;</span><span class=\"hljs-punctuation\">,</span><span class=\"hljs-comment\">// 可用模型列表</span><br>    <span class=\"hljs-string\">&quot;model2&quot;</span><span class=\"hljs-punctuation\">,</span> <br>    <span class=\"hljs-string\">&quot;model3&quot;</span><span class=\"hljs-punctuation\">,</span><br><span class=\"hljs-punctuation\">]</span>;<br></code></pre></td></tr></table></figure>\n<p>这里需要填入你下载下来的文件名，不需要后缀<br>例如我的是<code>build_char_017_huang_witch_5</code> <code>build_char_017_huang</code> <code>build_char_017_huang_as_1</code> <code>build_char_1040_blaze2</code></p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">var MODELS = <span class=\"hljs-punctuation\">[</span> <span class=\"hljs-comment\">// 模型列表</span><br>    <span class=\"hljs-string\">&quot;build_char_017_huang_witch_5&quot;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-string\">&quot;build_char_017_huang&quot;</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-comment\">// 可用模型列表</span><br>    <span class=\"hljs-string\">&quot;build_char_017_huang_as_1&quot;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-string\">&quot;build_char_1040_blaze2&quot;</span><span class=\"hljs-punctuation\">,</span><br><span class=\"hljs-punctuation\">]</span>;<br></code></pre></td></tr></table></figure>\n<p>里面的模型每刷新一次就会随机更换</p>\n<h2 id=\"模型显示大小调整\"><a href=\"#模型显示大小调整\" class=\"headerlink\" title=\"模型显示大小调整\"></a>模型显示大小调整</h2><p><code>spine-widget.css</code></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\"><span class=\"hljs-attribute\">width</span>: <span class=\"hljs-number\">400px</span>;<br><span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">400px</span>;<br></code></pre></td></tr></table></figure>\n<p><code>spine-widget.js</code></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs css\"><span class=\"hljs-selector-tag\">canvas</span><span class=\"hljs-selector-class\">.width</span> = <span class=\"hljs-number\">400</span>;<br><span class=\"hljs-selector-tag\">canvas</span><span class=\"hljs-selector-class\">.height</span> = <span class=\"hljs-number\">400</span>;<br></code></pre></td></tr></table></figure>\n\n<p>修改成你想要的，默认分别是250x250，300x300</p>\n<p>我建议都调成300x300，我自己用的是400x400</p>\n<p>当然参数怎么调看你的心意，只是太大会很糊</p>\n","slug":"spineModel","updated":"2025-05-24T22:50:52.051Z","comments":true,"permalink":"https://blog.xunchufrd.dpdns.org/spineModel/","excerpt":"","categories":[{"name":"教程","slug":"教程","permalink":"https://blog.xunchufrd.dpdns.org/categories/%E6%95%99%E7%A8%8B/"}],"tags":[{"name":"前端","slug":"前端","permalink":"https://blog.xunchufrd.dpdns.org/tags/%E5%89%8D%E7%AB%AF/"}]},{"title":"hexo新版nexmoe主题加入aplayer 引入pjax防止切换页面刷新【FRD 01】","date":"2025-05-18T05:51:13.000Z","path":"aplayerWithPjax/","text":"前言加入aplayer（metingJS）实现在网页右下角添加播放器后，出现了切换页面刷新后音乐中断，进度丢失的问题，进而需要引入pjax实现切换页面不刷新 参考来源：Aplayer+MetingJS+Pjax&#x3D;网“页”云音乐 但是文章中使用layout布局文件是完整的ejs文件，而新版的nexmoe主题（大约是4.1.5后）已经将其拆分成了多个文件，其中layout变成了jsx文件，目录结构也有所改变 经过尝试已经完成修改并成功完成，（大）部分代码来源于Deepseek，简单做一下分享 修改部分以下文件都在/你的博客/node_modules/hexo-theme-nexmoe/layout/中 layout.jsx由于包含跳转页面的代码在layout.jsx中，因此无法使用hexo自带的劫持功能，需要修改layout.jsx 文件头部 12345const PJAX_CONFIG = &#123; selectors: [&#x27;#pageContent&#x27;], // 指定内容替换容器``` excludes: &#x27;#aplayerContent, .mdui-drawer&#x27;, // 排除播放器和侧边栏 timeout: 8000 &#125;; 中部 123456789101112return ( &lt;html lang=&#123;language ? language.substr(0, 2) : &#x27;&#x27;&#125;&gt; &lt;head dangerouslySetInnerHTML=&#123;&#123; __html: partial(&#x27;_partial/head&#x27;) + &#x27;&lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css&quot;/&gt;&#x27; + &#x27;&lt;script src=&quot;https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js&quot;&gt;&lt;/script&gt;&#x27; + // 新增 jQuery &#x27;&lt;script src=&quot;https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js&quot;&gt;&lt;/script&gt;&#x27; + // 新增 PJAX &#x27;&lt;script src=&quot;https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js&quot;&gt;&lt;/script&gt;&#x27; + &#x27;&lt;script src=&quot;https://cdn.jsdelivr.net/npm/meting@2.0.1/dist/Meting.min.js&quot;&gt;&lt;/script&gt;&#x27; &#125;&#125; &gt;&lt;/head&gt; 如果需要修改播放器css样式，上面的https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css需要改成自己的css文件地址 1234567891011121314151617181920212223242526272829303132&lt;SearchBox &#123;...this.props&#125; /&gt; &lt;div dangerouslySetInnerHTML=&#123;&#123; __html: theme.slotFooter &#125;&#125; &gt;&lt;/div&gt; &lt;div id=&quot;aplayerContent&quot;&gt; &lt;meting-js server=&quot;netease&quot; type=&quot;playlist&quot; id=&quot;your id&quot; fixed=&quot;true&quot; order=&quot;random&quot; list-max-height=&quot;1000px&quot; lrc-type=&quot;1&quot; data-pjax-persist&gt;&lt;/meting-js&gt; &lt;/div&gt; &lt;script dangerouslySetInnerHTML=&#123;&#123; __html: ` document.addEventListener(&#x27;DOMContentLoaded&#x27;, function() &#123; // 初始化 PJAX var pjax = new Pjax($&#123;JSON.stringify(PJAX_CONFIG)&#125;); // 页面切换后保持播放器 document.addEventListener(&#x27;pjax:end&#x27;, function() &#123; if(window.aplayers &amp;&amp; window.aplayers.length &gt; 0) &#123; window.aplayers[0].toggle(); &#125; &#125;); // 重新初始化 MetingJS document.addEventListener(&#x27;pjax:complete&#x27;, function() &#123; if(typeof Meting !== &#x27;undefined&#x27;) &#123; Meting.reload(); &#125; &#125;); &#125;); ` &#125;&#125;&gt;&lt;/script&gt;&lt;/body&gt; background.jsx这个在/layout/_partial下 把&lt;div id=&quot;nexmoe-background&quot;&gt;&lt;/div&gt; 里面的内容全都套在&lt;div id=&quot;pageContent&quot;&gt;&lt;/div&gt;中 123456&lt;a href=&#123;url_for()&#125; title=&#123;config.author || config.title&#125; class=&quot;mdui-btn mdui-btn-icon&quot; data-pjax // 新增属性&gt; searchbox.jsx也在/layout/_partial下 同样在&lt;div id=&quot;nexmoe-search-space&quot;&gt;&lt;/div&gt;外面套个&lt;div id=&quot;pageContent&quot;&gt;&lt;/div&gt; 中间 1234567&lt;input class=&quot;search-input&quot; type=&quot;text&quot; placeholder=&#123; __(&#x27;search&#x27;)&#125; onInput=&quot;sinput();&quot; data-no-pjax // 新增属性/&gt; body.jsx此文件在layout/_layout/nexmoe 需要在&lt;Fragment&gt;里面&lt;div id=&quot;nexmoe-header&quot;&gt;&lt;/div&gt;外面套一层&lt;div id=&quot;pageContent&quot; data-pjax-container&gt;&lt;/div&gt; 大功告成其实挺简单的对吧，但是我对前端一点都不熟，自己一个人搞了8小时","raw":"---\ntitle: hexo新版nexmoe主题加入aplayer 引入pjax防止切换页面刷新【FRD 01】\ndate: 2025-05-18 13:51:13\ntags:\n    - 前端\ncategories:\n    - 教程\ncover: /cover/02.png\ncoverWdith: 812\ncoverHeight: 500\n---\n# 前言\n加入aplayer（metingJS）实现在网页右下角添加播放器后，出现了切换页面刷新后音乐中断，进度丢失的问题，进而需要引入pjax实现切换页面不刷新\n\n参考来源：[Aplayer+MetingJS+Pjax=网“页”云音乐](https://631212502.github.io/2021/10/05/Aplayer-MetingJS-Pjax-%E7%BD%91%E2%80%9C%E9%A1%B5%E2%80%9D%E4%BA%91%E9%9F%B3%E4%B9%90/)\n\n但是文章中使用layout布局文件是完整的ejs文件，而新版的nexmoe主题（大约是4.1.5后）已经将其拆分成了多个文件，其中layout变成了jsx文件，目录结构也有所改变\n![目录结构](/workimg/01/01.png)\n\n经过尝试已经完成修改并成功完成，（大）部分代码来源于Deepseek，简单做一下分享\n\n# 修改部分\n以下文件都在``/你的博客/node_modules/hexo-theme-nexmoe/layout/``中\n## layout.jsx\n由于包含跳转页面的代码在layout.jsx中，因此无法使用hexo自带的劫持功能，需要修改layout.jsx\n\n文件头部\n\n```json\nconst PJAX_CONFIG = {\n    selectors: ['#pageContent'], // 指定内容替换容器```\n    excludes: '#aplayerContent, .mdui-drawer', // 排除播放器和侧边栏\n    timeout: 8000\n  };\n```\n中部\n```json\nreturn (\n    <html lang={language ? language.substr(0, 2) : ''}>\n        <head\n            dangerouslySetInnerHTML={{\n                __html: partial('_partial/head') +\n                '<link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css\"/>' +\n                '<script src=\"https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js\"></script>' + // 新增 jQuery\n                '<script src=\"https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js\"></script>' + // 新增 PJAX\n                '<script src=\"https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js\"></script>' +\n                '<script src=\"https://cdn.jsdelivr.net/npm/meting@2.0.1/dist/Meting.min.js\"></script>'\n            }}\n        ></head>\n```\n如果需要修改播放器css样式，上面的``https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css``需要改成自己的css文件地址\n```json\n<SearchBox {...this.props} />\n    <div\n        dangerouslySetInnerHTML={{\n            __html: theme.slotFooter\n        }}\n    ></div>\n    <div id=\"aplayerContent\">\n        <meting-js server=\"netease\" type=\"playlist\" id=\"your id\" fixed=\"true\" order=\"random\" list-max-height=\"1000px\" lrc-type=\"1\" data-pjax-persist></meting-js>\n    </div>\n    <script dangerouslySetInnerHTML={{\n        __html: `\n            document.addEventListener('DOMContentLoaded', function() {\n                // 初始化 PJAX\n                var pjax = new Pjax(${JSON.stringify(PJAX_CONFIG)});\n\n                // 页面切换后保持播放器\n                document.addEventListener('pjax:end', function() {\n                    if(window.aplayers && window.aplayers.length > 0) {\n                        window.aplayers[0].toggle();\n                    }\n                });\n\n                // 重新初始化 MetingJS\n                document.addEventListener('pjax:complete', function() {\n                    if(typeof Meting !== 'undefined') {\n                        Meting.reload();\n                    }\n                });\n            });\n        `\n    }}></script>\n</body>\n```\n## background.jsx\n这个在``/layout/_partial``下\n\n把``<div id=\"nexmoe-background\"></div> ``里面的内容全都套在``<div id=\"pageContent\"></div>``中\n\n```json\n<a\n    href={url_for()}\n    title={config.author || config.title}\n    class=\"mdui-btn mdui-btn-icon\"\n    data-pjax // 新增属性\n>\n```\n\n## searchbox.jsx\n也在``/layout/_partial``下\n\n同样在``<div id=\"nexmoe-search-space\"></div>``外面套个``<div id=\"pageContent\"></div>``\n\n中间\n``` json\n<input\n    class=\"search-input\"\n    type=\"text\"\n    placeholder={ __('search')}\n    onInput=\"sinput();\"\n    data-no-pjax // 新增属性\n/>\n```\n## body.jsx\n此文件在``layout/_layout/nexmoe``\n\n需要在``<Fragment>``里面``<div id=\"nexmoe-header\"></div>``外面套一层\n``<div id=\"pageContent\" data-pjax-container></div>``\n\n# 大功告成\n其实挺简单的对吧，但是我对前端一点都不熟，自己一个人搞了8小时","content":"<h1 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h1><p>加入aplayer（metingJS）实现在网页右下角添加播放器后，出现了切换页面刷新后音乐中断，进度丢失的问题，进而需要引入pjax实现切换页面不刷新</p>\n<p>参考来源：<a href=\"https://631212502.github.io/2021/10/05/Aplayer-MetingJS-Pjax-%E7%BD%91%E2%80%9C%E9%A1%B5%E2%80%9D%E4%BA%91%E9%9F%B3%E4%B9%90/\">Aplayer+MetingJS+Pjax&#x3D;网“页”云音乐</a></p>\n<p>但是文章中使用layout布局文件是完整的ejs文件，而新版的nexmoe主题（大约是4.1.5后）已经将其拆分成了多个文件，其中layout变成了jsx文件，目录结构也有所改变<br><img onerror=\"imgOnError(this);\" data-fancybox=\"gallery\" src=\"/workimg/01/01.png\" alt=\"目录结构\" data-caption=\"目录结构\" loading=\"lazy\"></p>\n<p>经过尝试已经完成修改并成功完成，（大）部分代码来源于Deepseek，简单做一下分享</p>\n<h1 id=\"修改部分\"><a href=\"#修改部分\" class=\"headerlink\" title=\"修改部分\"></a>修改部分</h1><p>以下文件都在<code>/你的博客/node_modules/hexo-theme-nexmoe/layout/</code>中</p>\n<h2 id=\"layout-jsx\"><a href=\"#layout-jsx\" class=\"headerlink\" title=\"layout.jsx\"></a>layout.jsx</h2><p>由于包含跳转页面的代码在layout.jsx中，因此无法使用hexo自带的劫持功能，需要修改layout.jsx</p>\n<p>文件头部</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">const PJAX_CONFIG = <span class=\"hljs-punctuation\">&#123;</span><br>    selectors<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span>&#x27;#pageContent&#x27;<span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-comment\">// 指定内容替换容器```</span><br>    excludes<span class=\"hljs-punctuation\">:</span> &#x27;#aplayerContent<span class=\"hljs-punctuation\">,</span> .mdui-drawer&#x27;<span class=\"hljs-punctuation\">,</span> <span class=\"hljs-comment\">// 排除播放器和侧边栏</span><br>    timeout<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-number\">8000</span><br>  <span class=\"hljs-punctuation\">&#125;</span>;<br></code></pre></td></tr></table></figure>\n<p>中部</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">return (<br>    &lt;html lang=<span class=\"hljs-punctuation\">&#123;</span>language ? language.substr(<span class=\"hljs-number\">0</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-number\">2</span>) <span class=\"hljs-punctuation\">:</span> &#x27;&#x27;<span class=\"hljs-punctuation\">&#125;</span>&gt;<br>        &lt;head<br>            dangerouslySetInnerHTML=<span class=\"hljs-punctuation\">&#123;</span><span class=\"hljs-punctuation\">&#123;</span><br>                __html<span class=\"hljs-punctuation\">:</span> partial(&#x27;_partial/head&#x27;) +<br>                &#x27;&lt;link rel=<span class=\"hljs-string\">&quot;stylesheet&quot;</span> href=<span class=\"hljs-string\">&quot;https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css&quot;</span>/&gt;&#x27; +<br>                &#x27;&lt;script src=<span class=\"hljs-string\">&quot;https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js&quot;</span>&gt;&lt;/script&gt;&#x27; + <span class=\"hljs-comment\">// 新增 jQuery</span><br>                &#x27;&lt;script src=<span class=\"hljs-string\">&quot;https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js&quot;</span>&gt;&lt;/script&gt;&#x27; + <span class=\"hljs-comment\">// 新增 PJAX</span><br>                &#x27;&lt;script src=<span class=\"hljs-string\">&quot;https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js&quot;</span>&gt;&lt;/script&gt;&#x27; +<br>                &#x27;&lt;script src=<span class=\"hljs-string\">&quot;https://cdn.jsdelivr.net/npm/meting@2.0.1/dist/Meting.min.js&quot;</span>&gt;&lt;/script&gt;&#x27;<br>            <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">&#125;</span><br>        &gt;&lt;/head&gt;<br></code></pre></td></tr></table></figure>\n<p>如果需要修改播放器css样式，上面的<code>https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css</code>需要改成自己的css文件地址</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">&lt;SearchBox <span class=\"hljs-punctuation\">&#123;</span>...this.props<span class=\"hljs-punctuation\">&#125;</span> /&gt;<br>    &lt;div<br>        dangerouslySetInnerHTML=<span class=\"hljs-punctuation\">&#123;</span><span class=\"hljs-punctuation\">&#123;</span><br>            __html<span class=\"hljs-punctuation\">:</span> theme.slotFooter<br>        <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">&#125;</span><br>    &gt;&lt;/div&gt;<br>    &lt;div id=<span class=\"hljs-string\">&quot;aplayerContent&quot;</span>&gt;<br>        &lt;meting-js server=<span class=\"hljs-string\">&quot;netease&quot;</span> type=<span class=\"hljs-string\">&quot;playlist&quot;</span> id=<span class=\"hljs-string\">&quot;your id&quot;</span> fixed=<span class=\"hljs-string\">&quot;true&quot;</span> order=<span class=\"hljs-string\">&quot;random&quot;</span> list-max-height=<span class=\"hljs-string\">&quot;1000px&quot;</span> lrc-type=<span class=\"hljs-string\">&quot;1&quot;</span> data-pjax-persist&gt;&lt;/meting-js&gt;<br>    &lt;/div&gt;<br>    &lt;script dangerouslySetInnerHTML=<span class=\"hljs-punctuation\">&#123;</span><span class=\"hljs-punctuation\">&#123;</span><br>        __html<span class=\"hljs-punctuation\">:</span> `<br>            document.addEventListener(&#x27;DOMContentLoaded&#x27;<span class=\"hljs-punctuation\">,</span> function() <span class=\"hljs-punctuation\">&#123;</span><br>                <span class=\"hljs-comment\">// 初始化 PJAX</span><br>                var pjax = new Pjax($<span class=\"hljs-punctuation\">&#123;</span>JSON.stringify(PJAX_CONFIG)<span class=\"hljs-punctuation\">&#125;</span>);<br><br>                <span class=\"hljs-comment\">// 页面切换后保持播放器</span><br>                document.addEventListener(&#x27;pjax<span class=\"hljs-punctuation\">:</span>end&#x27;<span class=\"hljs-punctuation\">,</span> function() <span class=\"hljs-punctuation\">&#123;</span><br>                    if(window.aplayers &amp;&amp; window.aplayers.length &gt; <span class=\"hljs-number\">0</span>) <span class=\"hljs-punctuation\">&#123;</span><br>                        window.aplayers<span class=\"hljs-punctuation\">[</span><span class=\"hljs-number\">0</span><span class=\"hljs-punctuation\">]</span>.toggle();<br>                    <span class=\"hljs-punctuation\">&#125;</span><br>                <span class=\"hljs-punctuation\">&#125;</span>);<br><br>                <span class=\"hljs-comment\">// 重新初始化 MetingJS</span><br>                document.addEventListener(&#x27;pjax<span class=\"hljs-punctuation\">:</span>complete&#x27;<span class=\"hljs-punctuation\">,</span> function() <span class=\"hljs-punctuation\">&#123;</span><br>                    if(typeof Meting !== &#x27;undefined&#x27;) <span class=\"hljs-punctuation\">&#123;</span><br>                        Meting.reload();<br>                    <span class=\"hljs-punctuation\">&#125;</span><br>                <span class=\"hljs-punctuation\">&#125;</span>);<br>            <span class=\"hljs-punctuation\">&#125;</span>);<br>        `<br>    <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">&#125;</span>&gt;&lt;/script&gt;<br>&lt;/body&gt;<br></code></pre></td></tr></table></figure>\n<h2 id=\"background-jsx\"><a href=\"#background-jsx\" class=\"headerlink\" title=\"background.jsx\"></a>background.jsx</h2><p>这个在<code>/layout/_partial</code>下</p>\n<p>把<code>&lt;div id=&quot;nexmoe-background&quot;&gt;&lt;/div&gt; </code>里面的内容全都套在<code>&lt;div id=&quot;pageContent&quot;&gt;&lt;/div&gt;</code>中</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">&lt;a<br>    href=<span class=\"hljs-punctuation\">&#123;</span>url_for()<span class=\"hljs-punctuation\">&#125;</span><br>    title=<span class=\"hljs-punctuation\">&#123;</span>config.author || config.title<span class=\"hljs-punctuation\">&#125;</span><br>    class=<span class=\"hljs-string\">&quot;mdui-btn mdui-btn-icon&quot;</span><br>    data-pjax <span class=\"hljs-comment\">// 新增属性</span><br>&gt;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"searchbox-jsx\"><a href=\"#searchbox-jsx\" class=\"headerlink\" title=\"searchbox.jsx\"></a>searchbox.jsx</h2><p>也在<code>/layout/_partial</code>下</p>\n<p>同样在<code>&lt;div id=&quot;nexmoe-search-space&quot;&gt;&lt;/div&gt;</code>外面套个<code>&lt;div id=&quot;pageContent&quot;&gt;&lt;/div&gt;</code></p>\n<p>中间</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">&lt;input<br>    class=<span class=\"hljs-string\">&quot;search-input&quot;</span><br>    type=<span class=\"hljs-string\">&quot;text&quot;</span><br>    placeholder=<span class=\"hljs-punctuation\">&#123;</span> __(&#x27;search&#x27;)<span class=\"hljs-punctuation\">&#125;</span><br>    onInput=<span class=\"hljs-string\">&quot;sinput();&quot;</span><br>    data-no-pjax <span class=\"hljs-comment\">// 新增属性</span><br>/&gt;<br></code></pre></td></tr></table></figure>\n<h2 id=\"body-jsx\"><a href=\"#body-jsx\" class=\"headerlink\" title=\"body.jsx\"></a>body.jsx</h2><p>此文件在<code>layout/_layout/nexmoe</code></p>\n<p>需要在<code>&lt;Fragment&gt;</code>里面<code>&lt;div id=&quot;nexmoe-header&quot;&gt;&lt;/div&gt;</code>外面套一层<br><code>&lt;div id=&quot;pageContent&quot; data-pjax-container&gt;&lt;/div&gt;</code></p>\n<h1 id=\"大功告成\"><a href=\"#大功告成\" class=\"headerlink\" title=\"大功告成\"></a>大功告成</h1><p>其实挺简单的对吧，但是我对前端一点都不熟，自己一个人搞了8小时</p>\n","slug":"aplayerWithPjax","updated":"2025-05-24T22:50:14.041Z","comments":true,"permalink":"https://blog.xunchufrd.dpdns.org/aplayerWithPjax/","excerpt":"","categories":[{"name":"教程","slug":"教程","permalink":"https://blog.xunchufrd.dpdns.org/categories/%E6%95%99%E7%A8%8B/"}],"tags":[{"name":"前端","slug":"前端","permalink":"https://blog.xunchufrd.dpdns.org/tags/%E5%89%8D%E7%AB%AF/"}]},{"title":"个人网站开通了！","date":"2025-05-04T07:39:22.000Z","path":"intro/","text":"简要介绍你们好！ 欢迎来到椛的联络站! 这里可以看到我的更多信息 如果你在访问本网站时遇到问题，可以在github上提交发现的bug，当然，也可以提交失效需补档的资源 网站作用发布教程的文字版、记录往期视频的资源链接以及随记、近况的编写 少女祈祷中……github的网站一直都很慢。嗯，至少在国内是这样 05&#x2F;25更新：更换好友的服务器，体验会好一点了","raw":"---\ntitle: 个人网站开通了！\ndate: 2025-05-04 15:39:22\ntags: \n    - 说明\ncategories:\n    - 随记\ncover: /cover/01.png\n\n---\n## 简要介绍\n你们好！\n\n欢迎来到[椛的联络站](https://blog.xunchufrd.dpdns.org/)! [这里](profile.html)可以看到我的更多信息\n\n如果你在访问本网站时遇到问题，可以在[github](https://github.com/xunchufrd/xunchufrd.github.io/issues)上提交发现的bug，当然，也可以提交失效需补档的资源\n\n## 网站作用\n发布教程的文字版、记录往期视频的资源链接以及随记、近况的编写\n\n\n## 少女祈祷中......\n<s>github的网站一直都很慢。嗯，至少在国内是这样</s>\n\n05/25更新：更换好友的服务器，体验会好一点了","content":"<h2 id=\"简要介绍\"><a href=\"#简要介绍\" class=\"headerlink\" title=\"简要介绍\"></a>简要介绍</h2><p>你们好！</p>\n<p>欢迎来到<a href=\"https://blog.xunchufrd.dpdns.org/\">椛的联络站</a>! <a href=\"profile.html\">这里</a>可以看到我的更多信息</p>\n<p>如果你在访问本网站时遇到问题，可以在<a href=\"https://github.com/xunchufrd/xunchufrd.github.io/issues\">github</a>上提交发现的bug，当然，也可以提交失效需补档的资源</p>\n<h2 id=\"网站作用\"><a href=\"#网站作用\" class=\"headerlink\" title=\"网站作用\"></a>网站作用</h2><p>发布教程的文字版、记录往期视频的资源链接以及随记、近况的编写</p>\n<h2 id=\"少女祈祷中……\"><a href=\"#少女祈祷中……\" class=\"headerlink\" title=\"少女祈祷中……\"></a>少女祈祷中……</h2><p><s>github的网站一直都很慢。嗯，至少在国内是这样</s></p>\n<p>05&#x2F;25更新：更换好友的服务器，体验会好一点了</p>\n","slug":"intro","updated":"2025-05-25T00:09:36.304Z","comments":true,"permalink":"https://blog.xunchufrd.dpdns.org/intro/","excerpt":"","categories":[{"name":"随记","slug":"随记","permalink":"https://blog.xunchufrd.dpdns.org/categories/%E9%9A%8F%E8%AE%B0/"}],"tags":[{"name":"说明","slug":"说明","permalink":"https://blog.xunchufrd.dpdns.org/tags/%E8%AF%B4%E6%98%8E/"}]}]